<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner</title>
    <script src="/qr-scanner.umd.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
        }

        html, body {
            height: 100dvh;
        }

        body {
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            background-color: antiquewhite;
            font-family: Arial, Helvetica, sans-serif;
        }

        .video {
            flex-grow: 1;
            width: 100%;
            background-color: black;
        }
        .video div,
        .video video {
            width: 100%;
            height: 100%;
        }

        .popup {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #ffffffb6;
            padding: 1rem;
            border-radius: 0.5rem;
            pointer-events: none;
            user-select: none;
            transition: opacity 250ms;
            opacity: 0;
        }
        .popup-open {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>Сканер квеста</h1>
    <h2>{{quest.name}}</h2>
    <div class="video">
        <div>
            <video id="video"></video>
        </div>
    </div>
    <div class="popup" id="popup">popup</div>
    <script>
        const popup = document.getElementById("popup");
        let timeout = null;
        function showPopup(msg) {
            popup.innerText = msg;
            popup.classList.add("popup-open");
            if (timeout) {
                clearTimeout(timeout);
                timeout = null;
            }
            timeout = setTimeout(() => popup.classList.remove("popup-open"), 1000);
        }

        const qrScanner = new QrScanner(
            document.getElementById("video"),
            result => showPopup('decoded qr code:\n' + result.data),
            { highlightScanRegion: true, maxScansPerSecond: 10 },
        );

        qrScanner.start().catch(() =>
        {
            setTimeout(() =>
            {
                qrScanner.start().catch(() => showPopup("Нет доступа к камере\nРазрешите использование камеры этому сайту и браузеру, который вы используте."));
            }, 250);
        })
    </script>
</body>
</html>