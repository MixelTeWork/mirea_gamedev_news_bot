# init

## run
alembic init alembic

## alembic.ini
file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(rev)s_%%(slug)s

## env.py
from bafser.db_session import SqlAlchemyBase
from bafser.utils.import_all_tables import import_all_tables
import bafser_config
import_all_tables()
target_metadata = SqlAlchemyBase.metadata

issqlite = os.environ.get("dev", "0") == "1"
if issqlite:
    config.set_main_option("sqlalchemy.url", f"sqlite:///{bafser_config.db_dev_path}?check_same_thread=False")
else:
    config.set_main_option("sqlalchemy.url", f"mysql+pymysql://{bafser_config.db_path}?charset=UTF8mb4")

---
context.configure(
    ...
    render_as_batch=issqlite,

## drop all tables

## run
set dev=1
alembic revision --autogenerate -m "init"
alembic upgrade head


# usage

## if running local
set dev=1

## add version
alembic revision --autogenerate -m "version name"

## upgrade
alembic upgrade head
python3.9 -m alembic.config upgrade head

## set version (for existing db without alembic)
alembic stamp %version_id%
